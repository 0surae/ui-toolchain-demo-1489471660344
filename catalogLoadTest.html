<!DOCTYPE html>
<html>

  <head>
    <title>Catalog API load tester</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script>
      function callLoad() {
          var status = document.getElementById("status");
          status.textContent = "Running...";
          var button = document.getElementById("button");
          button.disabled = true;
          var table = document.getElementById("resultsTable");
          var count = Math.floor(document.getElementById("countText").value);
          count = Math.min(Math.max(count, 1), 1000);

          $.ajax({
            type: "GET",
            contentType: "application/json",
            url: "/ajaxCatalogLoadTest.php?count=" + count,
            success: function(result) {
                result = JSON.parse(result);
                status.textContent = "";
                button.disabled = false;
                var row = table.insertRow();
                var successCell = row.insertCell();
                var text = document.createTextNode("success count: " + result.success);
                successCell.appendChild(text);
                var failCell = row.insertCell();
                text = document.createTextNode("failure count: " + result.fail);
                failCell.appendChild(text);
                var timeCell = row.insertCell();
                text = document.createTextNode("time (ms): " + result.time);
                timeCell.appendChild(text);
            },
            error: function(XMLHttpRequest, textStatus, errorThrown) {
                status.textContent = "";
                button.disabled = false;
                var row = table.insertRow();
                var cell = row.insertCell();
                var text = document.createTextNode("failure: " + XMLHttpRequest.responseText);
                cell.appendChild(text);
            }
          });
      }
    </script>
  </head>

  <body>
    Test count:
    <input type="number" id="countText" value="100"></input>
    <button type="button" id="button" style="position:static;" onclick="callLoad()">Click to start</button>
    <span id="status"></span>
    <table id="resultsTable"></table>
  </body>

</html>

